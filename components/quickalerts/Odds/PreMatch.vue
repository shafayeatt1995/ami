<template>
  <b-row no-gutters class="mb-3">
    <b-col md="6">
      <footy-dropdown-select
        :options="oddGroups"
        v-model="group"
        label="Groups"
        @input="toggleType"
        class="mr-md-1 mr-0"
      ></footy-dropdown-select>
    </b-col>
    <b-col md="6">
      <footy-dropdown-select
        :options="bookmakers"
        v-model="bookmaker"
        label="Bookmakers"
        class="ml-md-1 m-0"
      ></footy-dropdown-select>
    </b-col>
    <b-col cols="12">
      <div class="odds-container">
        <div v-if="loading" class="d-flex justify-content-center">
          <Loader />
        </div>
        <odds-container
          :filteredOdds="filteredOdds"
          @addOdd="addOdd"
        ></odds-container>
      </div>
    </b-col>
  </b-row>
</template>

<script>
import OddsContainer from './OddsContainer.vue';

export default {
  components: {OddsContainer},
  name: 'PreMatch',
  props: {
    is_live_mode: Boolean,
  },
  data() {
    return {
      odds: null,
      filteredOdds: null,
      oddGroups: [
        {text: 'All', value: 'all'},
        {text: 'Result', value: 'result'},
        {text: 'Goals', value: 'goals'},
        {text: 'Corners', value: 'corners'},
        {text: 'Half', value: 'half'},
        {text: 'Asian', value: 'asian'},
      ],

      group: 'all',
      loading: false,
      showNote: false,
      oddBookmakers: [],
      bookmaker: '10Bet',
      selectedTab: 'Prematch',
    };
  },
  mounted() {
    this.fetchList();
    this.fetchBookmakers();
  },
  methods: {
    filterOdds(odds, key) {
      const tempOdds = [];

      if (key == 'all') {
        return odds;
      }
      odds.forEach((odd) => {
        // Check if group is comma separared and have current key
        if (odd.groups.indexOf(',') > -1) {
          if (odd.groups.split(',').includes(key)) {
            tempOdds.push(odd);
          }
        }
        // Check if group is simple and have current key === group
        if (odd.groups == key) {
          tempOdds.push(odd);
        }
      });
      return tempOdds;
    },
    async fetchList() {
      try {
        let odds;
        this.loading = true;
        const ax = await this.$axios.create();
        ax.setBaseURL('/');
        odds = await ax.$get('json/odds.json');
        this.odds = odds;
        this.loading = false;
        this.filteredOdds = this.filterOdds(this.odds, this.group);
      } catch (e) {
        console.log(e);
      }
    },
    async fetchBookmakers() {
      let bookmakers;
      const ax = await this.$axios.create();
      ax.setBaseURL('/');
      bookmakers = await ax.$get('json/bookmakers.json');
      bookmakers = bookmakers.filter((bookmaker) => bookmaker.data);
      this.oddBookmakers = bookmakers[0].data;
    },
    toggleType(val) {
      this.group = val;
      this.filteredOdds = this.filterOdds(this.odds, this.group);
    },
    addOdd(odd) {
      this.$emit('addOdd', odd);
    },
  },
  computed: {
    bookmakers() {
      return this.oddBookmakers.map((key) => {
        return {
          text: key.name,
          value: key.name,
        };
      });
    },
  },
};
</script>

<style lang="scss"></style>
